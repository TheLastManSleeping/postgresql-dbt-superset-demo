

# ELT Стенд: dbt + PostgreSQL + Superset

Этот проект представляет собой готовый `docker-compose` стенд для демонстрации ELT-процесса (Extract, Load, Transform) с использованием dbt, PostgreSQL и Apache Superset.

## Архитектура и рабочий процесс

1.  **Загрузка (Load)**: При первом запуске сервис `data-loader` скачивает "сырые" данные о поездках такси и загружает их в PostgreSQL.
2.  **Трансформация (Transform)**: Вы вручную запускаете команду `dbt run`, которая берет "сырые" данные, преобразует их с помощью SQL-модели и создает чистую, готовую к анализу витрину данных.
3.  **Визуализация (BI)**: Apache Superset подключается к витрине данных в PostgreSQL для создания дашбордов.

<!-- end list -->

```
+---------------+      +----------------+      +-------------+      +--------------------+
|               |      |                |      |             |      |                    |
|  Data Loader  |----->|   PostgreSQL   |<---->|     dbt     |----->|  Apache Superset   |
| (Python)      |      | (База данных)  |      | (Трансформации)|      | (Визуализация) |
|               |      |                |      |             |      |                    |
+---------------+      +----------------+      +-------------+      +--------------------+
```


-----

## Структура проекта

```
.
├── docker-compose.yml      # Главный файл, описывающий все сервисы
├── README.md               # Этот файл
│
├── data_loader/
│   ├── Dockerfile
│   ├── loader.py           # Скачивание и загрузки данных
│   └── requirements.txt
│
├── superset_custom/ #Кастомный superset
│
└── dbt_project/
    ├── models/
    │   ├── schema.yml      # Описание и тесты для моделей
    │   └── marts/
    │       └── agg_trip_stats.sql # Финальная витрина
    ├── dbt_project.yml     # Конфигурация dbt-проекта
    └── profiles.yml        # Настройки подключения к PostgreSQL
```

-----

## Как запустить

#### 1\. Подготовка

Склонируйте репозиторий и перейдите в папку проекта.

#### 2\. Запуск

```bash
docker compose up -d --build
```


При первом запуске сервис `data-loader` скачает данные. Это может занять несколько минут.

-----

## Рабочий процесс после запуска

#### 1\. Дождитесь загрузки данных

Следите за логами `data-loader`, чтобы понять, когда он закончит.

```bash
docker compose logs -f data-loader
```

Дождитесь сообщения: `Successfully loaded ... records into 'raw_taxi_trips'`.

#### 2\. Запустите трансформацию dbt

Когда данные загружены, выполните `dbt run`.

```bash
docker compose exec dbt dbt run
```

Эта команда создаст витрину `agg_trip_stats`.

#### 3\. Настройте Superset

1.  Откройте **[http://localhost:8088](https://www.google.com/search?q=http://localhost:8088)** и войдите, используя `admin` / `admin`.
2.  В меню **Data -\> Datasets** нажмите **+ Dataset**.
3.  Выберите `PostgreSQL`, схему `public` и таблицу `agg_trip_stats`.
4.  Нажмите **ADD**.
5.  Теперь вы можете создавать графики и дашборды на основе этого датасета.

-----

## Остановка проекта

  * **Обычная остановка**:
    ```bash
    docker compose down
    ```
  * **Полная очистка** (удаляет контейнеры и все данные):
    ```bash
    docker compose down -v
    ```